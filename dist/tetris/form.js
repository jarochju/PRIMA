"use strict";
var Tetris;
(function (Tetris) {
    var ƒ = FudgeCore;
    class Form extends ƒ.Node {
        constructor(startPos = ƒ.Vector3.ZERO()) {
            super('Form');
            this.unit = Form.staticUnit;
            this.color = ƒ.Color.CSS('WHITE');
            startPos.scale(this.unit);
            this.addComponent(new ƒ.ComponentTransform(ƒ.Matrix4x4.TRANSLATION(startPos)));
            this.container = new ƒ.Node('Form_Container');
            this.container.addComponent(new ƒ.ComponentTransform(ƒ.Matrix4x4.TRANSLATION(ƒ.Vector3.ZERO())));
            this.appendChild(this.container);
        }
        static random() {
            let r = Math.random();
            let p = 1 / 7;
            let rx = Math.floor(Math.random() * 12) - 6;
            let y = 10;
            let form = new Form(new ƒ.Vector3(rx, y, 0));
            if (r > p * 6)
                form.createLN();
            else if (r > p * 5)
                form.createLL();
            else if (r > p * 4)
                form.createLR();
            else if (r > p * 3)
                form.createZL();
            else if (r > p * 2)
                form.createZR();
            else if (r > p * 1)
                form.createSQ();
            else if (r > p * 0)
                form.createTT();
            return form;
        }
        static floor(len, pos = ƒ.Vector3.ZERO()) {
            let form = new Form(pos);
            form.createLine(len, ƒ.Vector3.ZERO());
            return form;
        }
        static wall(len, pos = ƒ.Vector3.ZERO()) {
            let form = new Form(pos);
            while (len-- > 0)
                form.createQuad(new ƒ.Vector3(0, form.unit * len - form.unit, 0));
            0;
            return form;
        }
        get position() {
            return this.mtxWorld.translation;
        }
        tryMoveY(colliders) {
            // get local copy of local matrix
            // const localMtxCopy = this.mtxLocal.copy;
            const worldMtxCopy = this.mtxWorld.copy;
            // translate copy on y axis one unit down
            worldMtxCopy.translateY(-this.unit);
            for (const child of this.container.getChildren()) {
                const childWorldMtxCopy = child.mtxWorld.copy;
                childWorldMtxCopy.translateY(-this.unit);
                for (const collider of colliders) {
                    for (const other of collider.container.getChildren()) {
                        //const cp: ƒ.Vector3 = child.mtxWorld.translation;
                        const op = other.mtxWorld.translation;
                        if (!childWorldMtxCopy.translation.equals(ƒ.Vector3.ZERO()) &&
                            childWorldMtxCopy.translation.isInsideSphere(op, this.unit / 2)) {
                            /*
                            this.removeComponent(newTransform);
                            this.addComponent(negTransform);
                            */
                            // localMtx.translateY(this.unit, false);
                            console.log('bottom');
                            return false;
                        }
                    }
                }
            }
            this.mtxWorld.translateY(-this.unit, true);
            // this.mtxLocal.translateY(-this.unit, false);
            /*
            let transform: ƒ.ComponentTransform = this.getComponent(
                ƒ.ComponentTransform
            );
            
            let matrix: ƒ.Matrix4x4 = transform.mtxLocal.copy;

            let negDir: ƒ.Vector3 = this.dirY.copy;
            negDir.scale(-1);
            let negTrix: ƒ.Matrix4x4 = transform.mtxLocal.copy;

            matrix.translate(this.dirY);
            negTrix.translate(negDir);

            let newTransform: ƒ.ComponentTransform = new ƒ.ComponentTransform(
                matrix
            );
            let negTransform: ƒ.ComponentTransform = new ƒ.ComponentTransform(
                negTrix
            );

            this.removeComponent(transform);
            this.addComponent(newTransform);

            for (let child of this.container.getChildren()) {
                for (let collider of colliders) {
                    for (let other of collider.container.getChildren()) {
                        let cp: ƒ.Vector3 = child.mtxWorld.translation;
                        let op: ƒ.Vector3 = other.mtxWorld.translation;

                        if (
                            !cp.equals(ƒ.Vector3.ZERO()) &&
                            cp.isInsideSphere(op, this.unit / 2)
                        ) {
                            this.removeComponent(newTransform);
                            this.addComponent(negTransform);
                            return false;
                        }
                    }
                }
            }
            return true;
            */
            return true;
        }
        moveX(dirX) {
            dirX.scale(this.unit);
            let transform = this.getComponent(ƒ.ComponentTransform);
            let matrix = transform.mtxLocal.copy;
            matrix.translate(dirX);
            this.removeComponent(transform);
            this.addComponent(new ƒ.ComponentTransform(matrix));
        }
        rotateZ(dir) {
            let transform = this.container.getComponent(ƒ.ComponentTransform);
            let matrix = transform.mtxLocal.copy;
            matrix.rotateZ(dir * 90);
            this.container.removeComponent(transform);
            this.container.addComponent(new ƒ.ComponentTransform(matrix));
        }
        createLine(len, pos = ƒ.Vector3.ZERO()) {
            while (len-- > 0)
                this.createQuad(new ƒ.Vector3(this.unit * len - this.unit + pos.x, 0 + pos.y, 0 + pos.z));
        }
        createLN() {
            this.color = ƒ.Color.CSS('CYAN');
            this.createLine(4, ƒ.Vector3.ZERO());
        }
        createLL() {
            this.color = ƒ.Color.CSS('MAGENTA');
            this.createLine(3);
            this.createQuad(new ƒ.Vector3(-this.unit, this.unit, 0));
        }
        createLR() {
            this.color = ƒ.Color.CSS('YELLOW');
            this.createLine(3);
            this.createQuad(new ƒ.Vector3(this.unit, this.unit, 0));
        }
        createZL() {
            this.color = ƒ.Color.CSS('RED');
            this.createLine(2, new ƒ.Vector3(this.unit, 0, 0));
            this.createLine(2, new ƒ.Vector3(0, 0 + this.unit, 0));
        }
        createZR() {
            this.color = ƒ.Color.CSS('GREEN');
            this.createLine(2);
            this.createLine(2, new ƒ.Vector3(this.unit, 0 + this.unit, 0));
        }
        createSQ() {
            this.color = ƒ.Color.CSS('BLUE');
            this.createLine(2);
            this.createLine(2, new ƒ.Vector3(0, this.unit, 0));
        }
        createTT() {
            this.color = ƒ.Color.CSS('ORANGE');
            this.createLine(3);
            this.createQuad(new ƒ.Vector3(0, 0 + this.unit, 0));
        }
        createQuad(pos) {
            let mesh = new ƒ.MeshQuad();
            let material = new ƒ.Material('Solid' + this.color.getCSS(), ƒ.ShaderUniColor, new ƒ.CoatColored(this.color));
            let segment = new ƒ.Node('Segment');
            let cmpMesh = new ƒ.ComponentMesh(mesh);
            segment.addComponent(cmpMesh);
            let cmpMaterial = new ƒ.ComponentMaterial(material);
            segment.addComponent(cmpMaterial);
            segment.addComponent(new ƒ.ComponentTransform(ƒ.Matrix4x4.TRANSLATION(pos)));
            this.container.appendChild(segment);
        }
    }
    Form.staticUnit = 1.05;
    Tetris.Form = Form;
})(Tetris || (Tetris = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90ZXRyaXMvZm9ybS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsSUFBVSxNQUFNLENBMFBmO0FBMVBELFdBQVUsTUFBTTtJQUNaLElBQU8sQ0FBQyxHQUFHLFNBQVMsQ0FBQztJQUVyQixNQUFhLElBQUssU0FBUSxDQUFDLENBQUMsSUFBSTtRQU81QixZQUFZLFdBQXNCLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFO1lBQzlDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztZQU5YLFNBQUksR0FBVyxJQUFJLENBQUMsVUFBVSxDQUFDO1lBRTlCLFVBQUssR0FBWSxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUsxQyxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMxQixJQUFJLENBQUMsWUFBWSxDQUNiLElBQUksQ0FBQyxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQzlELENBQUM7WUFDRixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBQzlDLElBQUksQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUN2QixJQUFJLENBQUMsQ0FBQyxrQkFBa0IsQ0FDcEIsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUM1QyxDQUNKLENBQUM7WUFDRixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNyQyxDQUFDO1FBRU0sTUFBTSxDQUFDLE1BQU07WUFDaEIsSUFBSSxDQUFDLEdBQVcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQzlCLElBQUksQ0FB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QixJQUFJLENBQUMsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDekQsT0FBTyxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUM5QixJQUFJLFdBQVcsR0FBd0IsSUFBSSxDQUFDLENBQUMsaUJBQWlCLENBQzFELFFBQVEsQ0FDWCxDQUFDO1lBQ0YsT0FBTyxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUNsQyxPQUFPLENBQUMsWUFBWSxDQUNoQixJQUFJLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUN6RCxDQUFDO1lBQ0YsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDeEMsQ0FBQzs7SUFwUGEsZUFBVSxHQUFXLElBQUksQ0FBQztJQUQvQixXQUFJLE9Bc1BoQixDQUFBO0FBQ0wsQ0FBQyxFQTFQUyxNQUFNLEtBQU4sTUFBTSxRQTBQZiIsInNvdXJjZXNDb250ZW50IjpbIm5hbWVzcGFjZSBUZXRyaXMge1xyXG4gICAgaW1wb3J0IMaSID0gRnVkZ2VDb3JlO1xyXG5cclxuICAgIGV4cG9ydCBjbGFzcyBGb3JtIGV4dGVuZHMgxpIuTm9kZSB7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBzdGF0aWNVbml0OiBudW1iZXIgPSAxLjA1O1xyXG4gICAgICAgIHB1YmxpYyB1bml0OiBudW1iZXIgPSBGb3JtLnN0YXRpY1VuaXQ7XHJcblxyXG4gICAgICAgIHByaXZhdGUgY29sb3I6IMaSLkNvbG9yID0gxpIuQ29sb3IuQ1NTKCdXSElURScpO1xyXG4gICAgICAgIHByaXZhdGUgY29udGFpbmVyOiDGki5Ob2RlO1xyXG5cclxuICAgICAgICBjb25zdHJ1Y3RvcihzdGFydFBvczogxpIuVmVjdG9yMyA9IMaSLlZlY3RvcjMuWkVSTygpKSB7XHJcbiAgICAgICAgICAgIHN1cGVyKCdGb3JtJyk7XHJcbiAgICAgICAgICAgIHN0YXJ0UG9zLnNjYWxlKHRoaXMudW5pdCk7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkQ29tcG9uZW50KFxyXG4gICAgICAgICAgICAgICAgbmV3IMaSLkNvbXBvbmVudFRyYW5zZm9ybSjGki5NYXRyaXg0eDQuVFJBTlNMQVRJT04oc3RhcnRQb3MpKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lciA9IG5ldyDGki5Ob2RlKCdGb3JtX0NvbnRhaW5lcicpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGRDb21wb25lbnQoXHJcbiAgICAgICAgICAgICAgICBuZXcgxpIuQ29tcG9uZW50VHJhbnNmb3JtKFxyXG4gICAgICAgICAgICAgICAgICAgIMaSLk1hdHJpeDR4NC5UUkFOU0xBVElPTijGki5WZWN0b3IzLlpFUk8oKSlcclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLmNvbnRhaW5lcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHJhbmRvbSgpOiBGb3JtIHtcclxuICAgICAgICAgICAgbGV0IHI6IG51bWJlciA9IE1hdGgucmFuZG9tKCk7XHJcbiAgICAgICAgICAgIGxldCBwOiBudW1iZXIgPSAxIC8gNztcclxuICAgICAgICAgICAgbGV0IHJ4OiBudW1iZXIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMikgLSA2O1xyXG4gICAgICAgICAgICBsZXQgeTogbnVtYmVyID0gMTA7XHJcbiAgICAgICAgICAgIGxldCBmb3JtOiBGb3JtID0gbmV3IEZvcm0obmV3IMaSLlZlY3RvcjMocngsIHksIDApKTtcclxuICAgICAgICAgICAgaWYgKHIgPiBwICogNikgZm9ybS5jcmVhdGVMTigpO1xyXG4gICAgICAgICAgICBlbHNlIGlmIChyID4gcCAqIDUpIGZvcm0uY3JlYXRlTEwoKTtcclxuICAgICAgICAgICAgZWxzZSBpZiAociA+IHAgKiA0KSBmb3JtLmNyZWF0ZUxSKCk7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHIgPiBwICogMykgZm9ybS5jcmVhdGVaTCgpO1xyXG4gICAgICAgICAgICBlbHNlIGlmIChyID4gcCAqIDIpIGZvcm0uY3JlYXRlWlIoKTtcclxuICAgICAgICAgICAgZWxzZSBpZiAociA+IHAgKiAxKSBmb3JtLmNyZWF0ZVNRKCk7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHIgPiBwICogMCkgZm9ybS5jcmVhdGVUVCgpO1xyXG4gICAgICAgICAgICByZXR1cm4gZm9ybTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZmxvb3IoXHJcbiAgICAgICAgICAgIGxlbjogbnVtYmVyLFxyXG4gICAgICAgICAgICBwb3M6IMaSLlZlY3RvcjMgPSDGki5WZWN0b3IzLlpFUk8oKVxyXG4gICAgICAgICk6IEZvcm0ge1xyXG4gICAgICAgICAgICBsZXQgZm9ybTogRm9ybSA9IG5ldyBGb3JtKHBvcyk7XHJcbiAgICAgICAgICAgIGZvcm0uY3JlYXRlTGluZShsZW4sIMaSLlZlY3RvcjMuWkVSTygpKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZvcm07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHdhbGwoXHJcbiAgICAgICAgICAgIGxlbjogbnVtYmVyLFxyXG4gICAgICAgICAgICBwb3M6IMaSLlZlY3RvcjMgPSDGki5WZWN0b3IzLlpFUk8oKVxyXG4gICAgICAgICk6IEZvcm0ge1xyXG4gICAgICAgICAgICBsZXQgZm9ybTogRm9ybSA9IG5ldyBGb3JtKHBvcyk7XHJcbiAgICAgICAgICAgIHdoaWxlIChsZW4tLSA+IDApXHJcbiAgICAgICAgICAgICAgICBmb3JtLmNyZWF0ZVF1YWQoXHJcbiAgICAgICAgICAgICAgICAgICAgbmV3IMaSLlZlY3RvcjMoMCwgZm9ybS51bml0ICogbGVuIC0gZm9ybS51bml0LCAwKVxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgMDtcclxuICAgICAgICAgICAgcmV0dXJuIGZvcm07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgZ2V0IHBvc2l0aW9uKCk6IMaSLlZlY3RvcjMge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5tdHhXb3JsZC50cmFuc2xhdGlvbjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB0cnlNb3ZlWShjb2xsaWRlcnM6IEZvcm1bXSk6IGJvb2xlYW4ge1xyXG4gICAgICAgICAgICAvLyBnZXQgbG9jYWwgY29weSBvZiBsb2NhbCBtYXRyaXhcclxuICAgICAgICAgICAgLy8gY29uc3QgbG9jYWxNdHhDb3B5ID0gdGhpcy5tdHhMb2NhbC5jb3B5O1xyXG4gICAgICAgICAgICBjb25zdCB3b3JsZE10eENvcHkgPSB0aGlzLm10eFdvcmxkLmNvcHk7XHJcblxyXG4gICAgICAgICAgICAvLyB0cmFuc2xhdGUgY29weSBvbiB5IGF4aXMgb25lIHVuaXQgZG93blxyXG4gICAgICAgICAgICB3b3JsZE10eENvcHkudHJhbnNsYXRlWSgtdGhpcy51bml0KTtcclxuXHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpcy5jb250YWluZXIuZ2V0Q2hpbGRyZW4oKSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY2hpbGRXb3JsZE10eENvcHkgPSBjaGlsZC5tdHhXb3JsZC5jb3B5O1xyXG4gICAgICAgICAgICAgICAgY2hpbGRXb3JsZE10eENvcHkudHJhbnNsYXRlWSgtdGhpcy51bml0KTtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGNvbGxpZGVyIG9mIGNvbGxpZGVycykge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgb3RoZXIgb2YgY29sbGlkZXIuY29udGFpbmVyLmdldENoaWxkcmVuKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zdCBjcDogxpIuVmVjdG9yMyA9IGNoaWxkLm10eFdvcmxkLnRyYW5zbGF0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvcDogxpIuVmVjdG9yMyA9IG90aGVyLm10eFdvcmxkLnRyYW5zbGF0aW9uO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIWNoaWxkV29ybGRNdHhDb3B5LnRyYW5zbGF0aW9uLmVxdWFscyhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDGki5WZWN0b3IzLlpFUk8oKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRXb3JsZE10eENvcHkudHJhbnNsYXRpb24uaXNJbnNpZGVTcGhlcmUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3AsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51bml0IC8gMlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUNvbXBvbmVudChuZXdUcmFuc2Zvcm0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRDb21wb25lbnQobmVnVHJhbnNmb3JtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsb2NhbE10eC50cmFuc2xhdGVZKHRoaXMudW5pdCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2JvdHRvbScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMubXR4V29ybGQudHJhbnNsYXRlWSgtdGhpcy51bml0LCB0cnVlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIHRoaXMubXR4TG9jYWwudHJhbnNsYXRlWSgtdGhpcy51bml0LCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAvKlxyXG4gICAgICAgICAgICBsZXQgdHJhbnNmb3JtOiDGki5Db21wb25lbnRUcmFuc2Zvcm0gPSB0aGlzLmdldENvbXBvbmVudChcclxuICAgICAgICAgICAgICAgIMaSLkNvbXBvbmVudFRyYW5zZm9ybVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbGV0IG1hdHJpeDogxpIuTWF0cml4NHg0ID0gdHJhbnNmb3JtLm10eExvY2FsLmNvcHk7XHJcblxyXG4gICAgICAgICAgICBsZXQgbmVnRGlyOiDGki5WZWN0b3IzID0gdGhpcy5kaXJZLmNvcHk7XHJcbiAgICAgICAgICAgIG5lZ0Rpci5zY2FsZSgtMSk7XHJcbiAgICAgICAgICAgIGxldCBuZWdUcml4OiDGki5NYXRyaXg0eDQgPSB0cmFuc2Zvcm0ubXR4TG9jYWwuY29weTtcclxuXHJcbiAgICAgICAgICAgIG1hdHJpeC50cmFuc2xhdGUodGhpcy5kaXJZKTtcclxuICAgICAgICAgICAgbmVnVHJpeC50cmFuc2xhdGUobmVnRGlyKTtcclxuXHJcbiAgICAgICAgICAgIGxldCBuZXdUcmFuc2Zvcm06IMaSLkNvbXBvbmVudFRyYW5zZm9ybSA9IG5ldyDGki5Db21wb25lbnRUcmFuc2Zvcm0oXHJcbiAgICAgICAgICAgICAgICBtYXRyaXhcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgbGV0IG5lZ1RyYW5zZm9ybTogxpIuQ29tcG9uZW50VHJhbnNmb3JtID0gbmV3IMaSLkNvbXBvbmVudFRyYW5zZm9ybShcclxuICAgICAgICAgICAgICAgIG5lZ1RyaXhcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlQ29tcG9uZW50KHRyYW5zZm9ybSk7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkQ29tcG9uZW50KG5ld1RyYW5zZm9ybSk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKGxldCBjaGlsZCBvZiB0aGlzLmNvbnRhaW5lci5nZXRDaGlsZHJlbigpKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBjb2xsaWRlciBvZiBjb2xsaWRlcnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBvdGhlciBvZiBjb2xsaWRlci5jb250YWluZXIuZ2V0Q2hpbGRyZW4oKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgY3A6IMaSLlZlY3RvcjMgPSBjaGlsZC5tdHhXb3JsZC50cmFuc2xhdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG9wOiDGki5WZWN0b3IzID0gb3RoZXIubXR4V29ybGQudHJhbnNsYXRpb247XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAhY3AuZXF1YWxzKMaSLlZlY3RvcjMuWkVSTygpKSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3AuaXNJbnNpZGVTcGhlcmUob3AsIHRoaXMudW5pdCAvIDIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVDb21wb25lbnQobmV3VHJhbnNmb3JtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkQ29tcG9uZW50KG5lZ1RyYW5zZm9ybSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIG1vdmVYKGRpclg6IMaSLlZlY3RvcjMpOiB2b2lkIHtcclxuICAgICAgICAgICAgZGlyWC5zY2FsZSh0aGlzLnVuaXQpO1xyXG4gICAgICAgICAgICBsZXQgdHJhbnNmb3JtOiDGki5Db21wb25lbnRUcmFuc2Zvcm0gPSB0aGlzLmdldENvbXBvbmVudChcclxuICAgICAgICAgICAgICAgIMaSLkNvbXBvbmVudFRyYW5zZm9ybVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBsZXQgbWF0cml4OiDGki5NYXRyaXg0eDQgPSB0cmFuc2Zvcm0ubXR4TG9jYWwuY29weTtcclxuICAgICAgICAgICAgbWF0cml4LnRyYW5zbGF0ZShkaXJYKTtcclxuICAgICAgICAgICAgdGhpcy5yZW1vdmVDb21wb25lbnQodHJhbnNmb3JtKTtcclxuICAgICAgICAgICAgdGhpcy5hZGRDb21wb25lbnQobmV3IMaSLkNvbXBvbmVudFRyYW5zZm9ybShtYXRyaXgpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyByb3RhdGVaKGRpcjogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgICAgIGxldCB0cmFuc2Zvcm06IMaSLkNvbXBvbmVudFRyYW5zZm9ybSA9IHRoaXMuY29udGFpbmVyLmdldENvbXBvbmVudChcclxuICAgICAgICAgICAgICAgIMaSLkNvbXBvbmVudFRyYW5zZm9ybVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBsZXQgbWF0cml4OiDGki5NYXRyaXg0eDQgPSB0cmFuc2Zvcm0ubXR4TG9jYWwuY29weTtcclxuICAgICAgICAgICAgbWF0cml4LnJvdGF0ZVooZGlyICogOTApO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5yZW1vdmVDb21wb25lbnQodHJhbnNmb3JtKTtcclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIuYWRkQ29tcG9uZW50KG5ldyDGki5Db21wb25lbnRUcmFuc2Zvcm0obWF0cml4KSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGNyZWF0ZUxpbmUoXHJcbiAgICAgICAgICAgIGxlbjogbnVtYmVyLFxyXG4gICAgICAgICAgICBwb3M6IMaSLlZlY3RvcjMgPSDGki5WZWN0b3IzLlpFUk8oKVxyXG4gICAgICAgICk6IHZvaWQge1xyXG4gICAgICAgICAgICB3aGlsZSAobGVuLS0gPiAwKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVRdWFkKFxyXG4gICAgICAgICAgICAgICAgICAgIG5ldyDGki5WZWN0b3IzKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVuaXQgKiBsZW4gLSB0aGlzLnVuaXQgKyBwb3MueCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgMCArIHBvcy55LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAwICsgcG9zLnpcclxuICAgICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBjcmVhdGVMTigpOiB2b2lkIHtcclxuICAgICAgICAgICAgdGhpcy5jb2xvciA9IMaSLkNvbG9yLkNTUygnQ1lBTicpO1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUxpbmUoNCwgxpIuVmVjdG9yMy5aRVJPKCkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBjcmVhdGVMTCgpOiB2b2lkIHtcclxuICAgICAgICAgICAgdGhpcy5jb2xvciA9IMaSLkNvbG9yLkNTUygnTUFHRU5UQScpO1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUxpbmUoMyk7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlUXVhZChuZXcgxpIuVmVjdG9yMygtdGhpcy51bml0LCB0aGlzLnVuaXQsIDApKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgY3JlYXRlTFIoKTogdm9pZCB7XHJcbiAgICAgICAgICAgIHRoaXMuY29sb3IgPSDGki5Db2xvci5DU1MoJ1lFTExPVycpO1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUxpbmUoMyk7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlUXVhZChuZXcgxpIuVmVjdG9yMyh0aGlzLnVuaXQsIHRoaXMudW5pdCwgMCkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBjcmVhdGVaTCgpOiB2b2lkIHtcclxuICAgICAgICAgICAgdGhpcy5jb2xvciA9IMaSLkNvbG9yLkNTUygnUkVEJyk7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlTGluZSgyLCBuZXcgxpIuVmVjdG9yMyh0aGlzLnVuaXQsIDAsIDApKTtcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVMaW5lKDIsIG5ldyDGki5WZWN0b3IzKDAsIDAgKyB0aGlzLnVuaXQsIDApKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgY3JlYXRlWlIoKTogdm9pZCB7XHJcbiAgICAgICAgICAgIHRoaXMuY29sb3IgPSDGki5Db2xvci5DU1MoJ0dSRUVOJyk7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlTGluZSgyKTtcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVMaW5lKDIsIG5ldyDGki5WZWN0b3IzKHRoaXMudW5pdCwgMCArIHRoaXMudW5pdCwgMCkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBjcmVhdGVTUSgpOiB2b2lkIHtcclxuICAgICAgICAgICAgdGhpcy5jb2xvciA9IMaSLkNvbG9yLkNTUygnQkxVRScpO1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUxpbmUoMik7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlTGluZSgyLCBuZXcgxpIuVmVjdG9yMygwLCB0aGlzLnVuaXQsIDApKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgY3JlYXRlVFQoKTogdm9pZCB7XHJcbiAgICAgICAgICAgIHRoaXMuY29sb3IgPSDGki5Db2xvci5DU1MoJ09SQU5HRScpO1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUxpbmUoMyk7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlUXVhZChuZXcgxpIuVmVjdG9yMygwLCAwICsgdGhpcy51bml0LCAwKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGNyZWF0ZVF1YWQocG9zOiDGki5WZWN0b3IzKTogdm9pZCB7XHJcbiAgICAgICAgICAgIGxldCBtZXNoOiDGki5NZXNoUXVhZCA9IG5ldyDGki5NZXNoUXVhZCgpO1xyXG4gICAgICAgICAgICBsZXQgbWF0ZXJpYWw6IMaSLk1hdGVyaWFsID0gbmV3IMaSLk1hdGVyaWFsKFxyXG4gICAgICAgICAgICAgICAgJ1NvbGlkJyArIHRoaXMuY29sb3IuZ2V0Q1NTKCksXHJcbiAgICAgICAgICAgICAgICDGki5TaGFkZXJVbmlDb2xvcixcclxuICAgICAgICAgICAgICAgIG5ldyDGki5Db2F0Q29sb3JlZCh0aGlzLmNvbG9yKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBsZXQgc2VnbWVudDogxpIuTm9kZSA9IG5ldyDGki5Ob2RlKCdTZWdtZW50Jyk7XHJcbiAgICAgICAgICAgIGxldCBjbXBNZXNoOiDGki5Db21wb25lbnRNZXNoID0gbmV3IMaSLkNvbXBvbmVudE1lc2gobWVzaCk7XHJcbiAgICAgICAgICAgIHNlZ21lbnQuYWRkQ29tcG9uZW50KGNtcE1lc2gpO1xyXG4gICAgICAgICAgICBsZXQgY21wTWF0ZXJpYWw6IMaSLkNvbXBvbmVudE1hdGVyaWFsID0gbmV3IMaSLkNvbXBvbmVudE1hdGVyaWFsKFxyXG4gICAgICAgICAgICAgICAgbWF0ZXJpYWxcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgc2VnbWVudC5hZGRDb21wb25lbnQoY21wTWF0ZXJpYWwpO1xyXG4gICAgICAgICAgICBzZWdtZW50LmFkZENvbXBvbmVudChcclxuICAgICAgICAgICAgICAgIG5ldyDGki5Db21wb25lbnRUcmFuc2Zvcm0oxpIuTWF0cml4NHg0LlRSQU5TTEFUSU9OKHBvcykpXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHNlZ21lbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=