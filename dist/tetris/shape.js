"use strict";
var Tetris;
(function (Tetris) {
    var ƒ = FudgeCore;
    class Shape extends ƒ.Node {
        constructor(startPos = ƒ.Vector3.ZERO(), isBorder = false) {
            super('Shape');
            this.unit = Shape.staticUnit;
            this.color = ƒ.Color.CSS('WHITE');
            startPos.scale(this.unit);
            this.addComponent(new ƒ.ComponentTransform(ƒ.Matrix4x4.TRANSLATION(startPos)));
            this.container = new ƒ.Node('Shape_Container');
            this.container.addComponent(new ƒ.ComponentTransform(ƒ.Matrix4x4.TRANSLATION(ƒ.Vector3.ZERO())));
            this.appendChild(this.container);
            this.isLevelBorder = isBorder;
        }
        static random() {
            let r = Math.random();
            let p = 1 / 7;
            let rx = Math.floor(Math.random() * 12) - 6;
            let y = 10;
            const form = new Shape(new ƒ.Vector3(rx, y, 0));
            if (r > p * 6)
                form.createLN();
            else if (r > p * 5)
                form.createLL();
            else if (r > p * 4)
                form.createLR();
            else if (r > p * 3)
                form.createZL();
            else if (r > p * 2)
                form.createZR();
            else if (r > p * 1)
                form.createSQ();
            else if (r > p * 0)
                form.createTT();
            return form;
        }
        static floor(len, pos = ƒ.Vector3.ZERO()) {
            let form = new Shape(pos, true);
            form.createLine(len, ƒ.Vector3.ZERO());
            return form;
        }
        static wall(len, pos = ƒ.Vector3.ZERO()) {
            let form = new Shape(pos, true);
            while (len-- > 0)
                form.createQuad(new ƒ.Vector3(0, form.unit * len - form.unit, 0));
            0;
            return form;
        }
        get position() {
            return this.mtxWorld.translation;
        }
        get containerNode() {
            return this.container;
        }
        get isBorder() {
            return this.isLevelBorder;
        }
        moveDown() {
            this.mtxLocal.translateY(-this.unit);
        }
        /** Versuche Form um einen Schritt nach unten zu bewegen */
        tryMove(colliders, dir) {
            // Kalkuliere Translation um eine Einheit nach unten
            const translationMtx = this.mtxLocal.copy;
            switch (dir) {
                case 'left':
                    translationMtx.translateX(-this.unit);
                    break;
                case 'right':
                    translationMtx.translateX(this.unit);
                    break;
                default:
                case 'down':
                    translationMtx.translateY(-this.unit);
                    break;
            }
            // Iteriere über jedes Segment einer Form und simuliere eine Translaton nach unten (Weltkoordinatensystem)
            for (const segment of this.container.getChildren()) {
                // Erstelle Matrixkopie des Segments
                const segmentMtx = segment.mtxWorld.copy;
                switch (dir) {
                    case 'left':
                        segmentMtx.translateX(-this.unit, false);
                        break;
                    case 'right':
                        segmentMtx.translateX(this.unit, false);
                        break;
                    default:
                    case 'down':
                        segmentMtx.translateY(-this.unit, false);
                        break;
                }
                // Prüfe ob die transformierten Segmentkopien mit den Collidern kollidieren
                for (const collider of colliders) {
                    for (const other of collider.container.getChildren()) {
                        const otherTrans = other.mtxWorld.translation;
                        if (!segmentMtx.translation.equals(ƒ.Vector3.ZERO()) &&
                            segmentMtx.translation.isInsideSphere(otherTrans, this.unit / 2)) {
                            // tue nichts, Form ist bereits am Boden
                            return false;
                        }
                    }
                }
            }
            // Wird ausgeführt wenn nicht kollidiert. Führe deshalb eine Translation der Form nach unten aus.
            this.cmpTransform.mtxLocal = translationMtx;
            return true;
        }
        rotateZ(dir) {
            this.container?.mtxLocal?.rotateZ(dir * 90);
        }
        createLine(len, pos = ƒ.Vector3.ZERO()) {
            while (len-- > 0)
                this.createQuad(new ƒ.Vector3(this.unit * len - this.unit + pos.x, 0 + pos.y, 0 + pos.z));
        }
        createLN() {
            this.color = ƒ.Color.CSS('CYAN');
            this.createLine(4, ƒ.Vector3.ZERO());
        }
        createLL() {
            this.color = ƒ.Color.CSS('MAGENTA');
            this.createLine(3);
            this.createQuad(new ƒ.Vector3(-this.unit, this.unit, 0));
        }
        createLR() {
            this.color = ƒ.Color.CSS('YELLOW');
            this.createLine(3);
            this.createQuad(new ƒ.Vector3(this.unit, this.unit, 0));
        }
        createZL() {
            this.color = ƒ.Color.CSS('RED');
            this.createLine(2, new ƒ.Vector3(this.unit, 0, 0));
            this.createLine(2, new ƒ.Vector3(0, 0 + this.unit, 0));
        }
        createZR() {
            this.color = ƒ.Color.CSS('GREEN');
            this.createLine(2);
            this.createLine(2, new ƒ.Vector3(this.unit, 0 + this.unit, 0));
        }
        createSQ() {
            this.color = ƒ.Color.CSS('BLUE');
            this.createLine(2);
            this.createLine(2, new ƒ.Vector3(0, this.unit, 0));
        }
        createTT() {
            this.color = ƒ.Color.CSS('ORANGE');
            this.createLine(3);
            this.createQuad(new ƒ.Vector3(0, 0 + this.unit, 0));
        }
        createQuad(pos) {
            let mesh = new ƒ.MeshQuad();
            let material = new ƒ.Material('Solid' + this.color.getCSS(), ƒ.ShaderUniColor, new ƒ.CoatColored(this.color));
            let segment = new ƒ.Node('Segment');
            let cmpMesh = new ƒ.ComponentMesh(mesh);
            segment.addComponent(cmpMesh);
            let cmpMaterial = new ƒ.ComponentMaterial(material);
            segment.addComponent(cmpMaterial);
            segment.addComponent(new ƒ.ComponentTransform(ƒ.Matrix4x4.TRANSLATION(pos)));
            this.container.appendChild(segment);
        }
    }
    Shape.staticUnit = 1.05;
    Tetris.Shape = Shape;
})(Tetris || (Tetris = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hhcGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdGV0cmlzL3NoYXBlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFVLE1BQU0sQ0FrT2Y7QUFsT0QsV0FBVSxNQUFNO0lBQ1osSUFBTyxDQUFDLEdBQUcsU0FBUyxDQUFDO0lBRXJCLE1BQWEsS0FBTSxTQUFRLENBQUMsQ0FBQyxJQUFJO1FBUTdCLFlBQVksV0FBc0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsRUFBRSxRQUFRLEdBQUcsS0FBSztZQUNoRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7WUFQWixTQUFJLEdBQVcsS0FBSyxDQUFDLFVBQVUsQ0FBQztZQUUvQixVQUFLLEdBQVksQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7WUFNMUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDMUIsSUFBSSxDQUFDLFlBQVksQ0FDYixJQUFJLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUM5RCxDQUFDO1lBQ0YsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztZQUMvQyxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FDdkIsSUFBSSxDQUFDLENBQUMsa0JBQWtCLENBQ3BCLENBQUMsQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FDNUMsQ0FDSixDQUFDO1lBQ0YsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDakMsSUFBSSxDQUFDLGFBQWEsR0FBRyxRQUFRLENBQUM7UUFDbEMsQ0FBQztRQUVNLE1BQU0sQ0FBQyxNQUFNO1lB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LFNBQVMsQ0FBQyxDQUFDO1lBQzVDLElBQUksT0FBTyxHQUFvQixJQUFJLENBQUMsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDekQsT0FBTyxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUM5QixJQUFJLFdBQVcsR0FBd0IsSUFBSSxDQUFDLENBQUMsaUJBQWlCLENBQzFELFFBQVEsQ0FDWCxDQUFDO1lBQ0YsT0FBTyxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUNsQyxPQUFPLENBQUMsWUFBWSxDQUNoQixJQUFJLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUN6RCxDQUFDO1lBQ0YsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDeEMsQ0FBQzs7SUE1TmEsZ0JBQVUsR0FBVyxJQUFJLENBQUM7SUFEL0IsWUFBSyxRQThOakIsQ0FBQTtBQUNMLENBQUMsRUFsT1MsTUFBTSxLQUFOLE1BQU0sUUFrT2YiLCJzb3VyY2VzQ29udGVudCI6WyJuYW1lc3BhY2UgVGV0cmlzIHtcclxuICAgIGltcG9ydCDGkiA9IEZ1ZGdlQ29yZTtcclxuXHJcbiAgICBleHBvcnQgY2xhc3MgU2hhcGUgZXh0ZW5kcyDGki5Ob2RlIHtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIHN0YXRpY1VuaXQ6IG51bWJlciA9IDEuMDU7XHJcbiAgICAgICAgcHVibGljIHVuaXQ6IG51bWJlciA9IFNoYXBlLnN0YXRpY1VuaXQ7XHJcblxyXG4gICAgICAgIHByaXZhdGUgY29sb3I6IMaSLkNvbG9yID0gxpIuQ29sb3IuQ1NTKCdXSElURScpO1xyXG4gICAgICAgIHByaXZhdGUgY29udGFpbmVyOiDGki5Ob2RlO1xyXG4gICAgICAgIHByaXZhdGUgaXNMZXZlbEJvcmRlcjogYm9vbGVhbjtcclxuXHJcbiAgICAgICAgY29uc3RydWN0b3Ioc3RhcnRQb3M6IMaSLlZlY3RvcjMgPSDGki5WZWN0b3IzLlpFUk8oKSwgaXNCb3JkZXIgPSBmYWxzZSkge1xyXG4gICAgICAgICAgICBzdXBlcignU2hhcGUnKTtcclxuICAgICAgICAgICAgc3RhcnRQb3Muc2NhbGUodGhpcy51bml0KTtcclxuICAgICAgICAgICAgdGhpcy5hZGRDb21wb25lbnQoXHJcbiAgICAgICAgICAgICAgICBuZXcgxpIuQ29tcG9uZW50VHJhbnNmb3JtKMaSLk1hdHJpeDR4NC5UUkFOU0xBVElPTihzdGFydFBvcykpXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyID0gbmV3IMaSLk5vZGUoJ1NoYXBlX0NvbnRhaW5lcicpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGRDb21wb25lbnQoXHJcbiAgICAgICAgICAgICAgICBuZXcgxpIuQ29tcG9uZW50VHJhbnNmb3JtKFxyXG4gICAgICAgICAgICAgICAgICAgIMaSLk1hdHJpeDR4NC5UUkFOU0xBVElPTijGki5WZWN0b3IzLlpFUk8oKSlcclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLmNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIHRoaXMuaXNMZXZlbEJvcmRlciA9IGlzQm9yZGVyO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyByYW5kb20oKTogU2hhcGUge1xyXG4gICAgICAgICAgICBsZXQgcjogbnVtYmVyID0gTWF0aC5yYW5kb20oKTtcclxuICAgICAgICAgICAgbGV0IHA6IG51bWJlciA9IDEgLyA3O1xyXG4gICAgICAgICAgICBsZXQgcng6IG51bWJlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEyKSAtIDY7XHJcbiAgICAgICAgICAgIGxldCB5OiBudW1iZXIgPSAxMDtcclxuICAgICAgICAgICAgY29uc3QgZm9ybTogU2hhcGUgPSBuZXcgU2hhcGUobmV3IMaSLlZlY3RvcjMocngsIHksIDApKTtcclxuICAgICAgICAgICAgaWYgKHIgPiBwICogNikgZm9ybS5jcmVhdGVMTigpO1xyXG4gICAgICAgICAgICBlbHNlIGlmIChyID4gcCAqIDUpIGZvcm0uY3JlYXRlTEwoKTtcclxuICAgICAgICAgICAgZWxzZSBpZiAociA+IHAgKiA0KSBmb3JtLmNyZWF0ZUxSKCk7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHIgPiBwICogMykgZm9ybS5jcmVhdGVaTCgpO1xyXG4gICAgICAgICAgICBlbHNlIGlmIChyID4gcCAqIDIpIGZvcm0uY3JlYXRlWlIoKTtcclxuICAgICAgICAgICAgZWxzZSBpZiAociA+IHAgKiAxKSBmb3JtLmNyZWF0ZVNRKCk7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHIgPiBwICogMCkgZm9ybS5jcmVhdGVUVCgpO1xyXG4gICAgICAgICAgICByZXR1cm4gZm9ybTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZmxvb3IoXHJcbiAgICAgICAgICAgIGxlbjogbnVtYmVyLFxyXG4gICAgICAgICAgICBwb3M6IMaSLlZlY3RvcjMgPSDGki5WZWN0b3IzLlpFUk8oKVxyXG4gICAgICAgICk6IFNoYXBlIHtcclxuICAgICAgICAgICAgbGV0IGZvcm06IFNoYXBlID0gbmV3IFNoYXBlKHBvcywgdHJ1ZSk7XHJcbiAgICAgICAgICAgIGZvcm0uY3JlYXRlTGluZShsZW4sIMaSLlZlY3RvcjMuWkVSTygpKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZvcm07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHdhbGwoXHJcbiAgICAgICAgICAgIGxlbjogbnVtYmVyLFxyXG4gICAgICAgICAgICBwb3M6IMaSLlZlY3RvcjMgPSDGki5WZWN0b3IzLlpFUk8oKVxyXG4gICAgICAgICk6IFNoYXBlIHtcclxuICAgICAgICAgICAgbGV0IGZvcm06IFNoYXBlID0gbmV3IFNoYXBlKHBvcywgdHJ1ZSk7XHJcbiAgICAgICAgICAgIHdoaWxlIChsZW4tLSA+IDApXHJcbiAgICAgICAgICAgICAgICBmb3JtLmNyZWF0ZVF1YWQoXHJcbiAgICAgICAgICAgICAgICAgICAgbmV3IMaSLlZlY3RvcjMoMCwgZm9ybS51bml0ICogbGVuIC0gZm9ybS51bml0LCAwKVxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgMDtcclxuICAgICAgICAgICAgcmV0dXJuIGZvcm07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgZ2V0IHBvc2l0aW9uKCk6IMaSLlZlY3RvcjMge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5tdHhXb3JsZC50cmFuc2xhdGlvbjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBnZXQgY29udGFpbmVyTm9kZSgpOiDGki5Ob2RlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29udGFpbmVyO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGdldCBpc0JvcmRlcigpOiBib29sZWFuIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNMZXZlbEJvcmRlcjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBtb3ZlRG93bigpOiB2b2lkIHtcclxuICAgICAgICAgICAgdGhpcy5tdHhMb2NhbC50cmFuc2xhdGVZKC10aGlzLnVuaXQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqIFZlcnN1Y2hlIEZvcm0gdW0gZWluZW4gU2Nocml0dCBuYWNoIHVudGVuIHp1IGJld2VnZW4gKi9cclxuICAgICAgICBwdWJsaWMgdHJ5TW92ZShcclxuICAgICAgICAgICAgY29sbGlkZXJzOiBTaGFwZVtdLFxyXG4gICAgICAgICAgICBkaXI6ICdsZWZ0JyB8ICdyaWdodCcgfCAnZG93bidcclxuICAgICAgICApOiBib29sZWFuIHtcclxuICAgICAgICAgICAgLy8gS2Fsa3VsaWVyZSBUcmFuc2xhdGlvbiB1bSBlaW5lIEVpbmhlaXQgbmFjaCB1bnRlblxyXG4gICAgICAgICAgICBjb25zdCB0cmFuc2xhdGlvbk10eCA9IHRoaXMubXR4TG9jYWwuY29weTtcclxuXHJcbiAgICAgICAgICAgIHN3aXRjaCAoZGlyKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdsZWZ0JzpcclxuICAgICAgICAgICAgICAgICAgICB0cmFuc2xhdGlvbk10eC50cmFuc2xhdGVYKC10aGlzLnVuaXQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgICAgICAgICAgICAgICB0cmFuc2xhdGlvbk10eC50cmFuc2xhdGVYKHRoaXMudW5pdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2Rvd24nOlxyXG4gICAgICAgICAgICAgICAgICAgIHRyYW5zbGF0aW9uTXR4LnRyYW5zbGF0ZVkoLXRoaXMudW5pdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIEl0ZXJpZXJlIMO8YmVyIGplZGVzIFNlZ21lbnQgZWluZXIgRm9ybSB1bmQgc2ltdWxpZXJlIGVpbmUgVHJhbnNsYXRvbiBuYWNoIHVudGVuIChXZWx0a29vcmRpbmF0ZW5zeXN0ZW0pXHJcbiAgICAgICAgICAgIGZvciAoY29uc3Qgc2VnbWVudCBvZiB0aGlzLmNvbnRhaW5lci5nZXRDaGlsZHJlbigpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBFcnN0ZWxsZSBNYXRyaXhrb3BpZSBkZXMgU2VnbWVudHNcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNlZ21lbnRNdHggPSBzZWdtZW50Lm10eFdvcmxkLmNvcHk7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGRpcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50TXR4LnRyYW5zbGF0ZVgoLXRoaXMudW5pdCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncmlnaHQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50TXR4LnRyYW5zbGF0ZVgodGhpcy51bml0LCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Rvd24nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50TXR4LnRyYW5zbGF0ZVkoLXRoaXMudW5pdCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBQcsO8ZmUgb2IgZGllIHRyYW5zZm9ybWllcnRlbiBTZWdtZW50a29waWVuIG1pdCBkZW4gQ29sbGlkZXJuIGtvbGxpZGllcmVuXHJcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGNvbGxpZGVyIG9mIGNvbGxpZGVycykge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgb3RoZXIgb2YgY29sbGlkZXIuY29udGFpbmVyLmdldENoaWxkcmVuKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJUcmFuczogxpIuVmVjdG9yMyA9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdGhlci5tdHhXb3JsZC50cmFuc2xhdGlvbjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICFzZWdtZW50TXR4LnRyYW5zbGF0aW9uLmVxdWFscyjGki5WZWN0b3IzLlpFUk8oKSkgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnRNdHgudHJhbnNsYXRpb24uaXNJbnNpZGVTcGhlcmUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3RoZXJUcmFucyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVuaXQgLyAyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdHVlIG5pY2h0cywgRm9ybSBpc3QgYmVyZWl0cyBhbSBCb2RlblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIFdpcmQgYXVzZ2Vmw7xocnQgd2VubiBuaWNodCBrb2xsaWRpZXJ0LiBGw7xocmUgZGVzaGFsYiBlaW5lIFRyYW5zbGF0aW9uIGRlciBGb3JtIG5hY2ggdW50ZW4gYXVzLlxyXG4gICAgICAgICAgICB0aGlzLmNtcFRyYW5zZm9ybS5tdHhMb2NhbCA9IHRyYW5zbGF0aW9uTXR4O1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyByb3RhdGVaKGRpcjogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyPy5tdHhMb2NhbD8ucm90YXRlWihkaXIgKiA5MCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGNyZWF0ZUxpbmUoXHJcbiAgICAgICAgICAgIGxlbjogbnVtYmVyLFxyXG4gICAgICAgICAgICBwb3M6IMaSLlZlY3RvcjMgPSDGki5WZWN0b3IzLlpFUk8oKVxyXG4gICAgICAgICk6IHZvaWQge1xyXG4gICAgICAgICAgICB3aGlsZSAobGVuLS0gPiAwKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVRdWFkKFxyXG4gICAgICAgICAgICAgICAgICAgIG5ldyDGki5WZWN0b3IzKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVuaXQgKiBsZW4gLSB0aGlzLnVuaXQgKyBwb3MueCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgMCArIHBvcy55LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAwICsgcG9zLnpcclxuICAgICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBjcmVhdGVMTigpOiB2b2lkIHtcclxuICAgICAgICAgICAgdGhpcy5jb2xvciA9IMaSLkNvbG9yLkNTUygnQ1lBTicpO1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUxpbmUoNCwgxpIuVmVjdG9yMy5aRVJPKCkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBjcmVhdGVMTCgpOiB2b2lkIHtcclxuICAgICAgICAgICAgdGhpcy5jb2xvciA9IMaSLkNvbG9yLkNTUygnTUFHRU5UQScpO1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUxpbmUoMyk7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlUXVhZChuZXcgxpIuVmVjdG9yMygtdGhpcy51bml0LCB0aGlzLnVuaXQsIDApKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgY3JlYXRlTFIoKTogdm9pZCB7XHJcbiAgICAgICAgICAgIHRoaXMuY29sb3IgPSDGki5Db2xvci5DU1MoJ1lFTExPVycpO1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUxpbmUoMyk7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlUXVhZChuZXcgxpIuVmVjdG9yMyh0aGlzLnVuaXQsIHRoaXMudW5pdCwgMCkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBjcmVhdGVaTCgpOiB2b2lkIHtcclxuICAgICAgICAgICAgdGhpcy5jb2xvciA9IMaSLkNvbG9yLkNTUygnUkVEJyk7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlTGluZSgyLCBuZXcgxpIuVmVjdG9yMyh0aGlzLnVuaXQsIDAsIDApKTtcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVMaW5lKDIsIG5ldyDGki5WZWN0b3IzKDAsIDAgKyB0aGlzLnVuaXQsIDApKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgY3JlYXRlWlIoKTogdm9pZCB7XHJcbiAgICAgICAgICAgIHRoaXMuY29sb3IgPSDGki5Db2xvci5DU1MoJ0dSRUVOJyk7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlTGluZSgyKTtcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVMaW5lKDIsIG5ldyDGki5WZWN0b3IzKHRoaXMudW5pdCwgMCArIHRoaXMudW5pdCwgMCkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBjcmVhdGVTUSgpOiB2b2lkIHtcclxuICAgICAgICAgICAgdGhpcy5jb2xvciA9IMaSLkNvbG9yLkNTUygnQkxVRScpO1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUxpbmUoMik7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlTGluZSgyLCBuZXcgxpIuVmVjdG9yMygwLCB0aGlzLnVuaXQsIDApKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgY3JlYXRlVFQoKTogdm9pZCB7XHJcbiAgICAgICAgICAgIHRoaXMuY29sb3IgPSDGki5Db2xvci5DU1MoJ09SQU5HRScpO1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUxpbmUoMyk7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlUXVhZChuZXcgxpIuVmVjdG9yMygwLCAwICsgdGhpcy51bml0LCAwKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGNyZWF0ZVF1YWQocG9zOiDGki5WZWN0b3IzKTogdm9pZCB7XHJcbiAgICAgICAgICAgIGxldCBtZXNoOiDGki5NZXNoUXVhZCA9IG5ldyDGki5NZXNoUXVhZCgpO1xyXG4gICAgICAgICAgICBsZXQgbWF0ZXJpYWw6IMaSLk1hdGVyaWFsID0gbmV3IMaSLk1hdGVyaWFsKFxyXG4gICAgICAgICAgICAgICAgJ1NvbGlkJyArIHRoaXMuY29sb3IuZ2V0Q1NTKCksXHJcbiAgICAgICAgICAgICAgICDGki5TaGFkZXJVbmlDb2xvcixcclxuICAgICAgICAgICAgICAgIG5ldyDGki5Db2F0Q29sb3JlZCh0aGlzLmNvbG9yKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBsZXQgc2VnbWVudDogxpIuTm9kZSA9IG5ldyDGki5Ob2RlKCdTZWdtZW50Jyk7XHJcbiAgICAgICAgICAgIGxldCBjbXBNZXNoOiDGki5Db21wb25lbnRNZXNoID0gbmV3IMaSLkNvbXBvbmVudE1lc2gobWVzaCk7XHJcbiAgICAgICAgICAgIHNlZ21lbnQuYWRkQ29tcG9uZW50KGNtcE1lc2gpO1xyXG4gICAgICAgICAgICBsZXQgY21wTWF0ZXJpYWw6IMaSLkNvbXBvbmVudE1hdGVyaWFsID0gbmV3IMaSLkNvbXBvbmVudE1hdGVyaWFsKFxyXG4gICAgICAgICAgICAgICAgbWF0ZXJpYWxcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgc2VnbWVudC5hZGRDb21wb25lbnQoY21wTWF0ZXJpYWwpO1xyXG4gICAgICAgICAgICBzZWdtZW50LmFkZENvbXBvbmVudChcclxuICAgICAgICAgICAgICAgIG5ldyDGki5Db21wb25lbnRUcmFuc2Zvcm0oxpIuTWF0cml4NHg0LlRSQU5TTEFUSU9OKHBvcykpXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHNlZ21lbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=